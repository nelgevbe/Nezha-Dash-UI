name: Auto Update Version

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è¿è¡Œ
  push:
    tags:
      - 'v*.*.*' # åŒ¹é…æ‰€æœ‰ vX.Y.Z æ ¼å¼çš„ Git Tag

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 
        ref: main
        
    - name: æå–æ–°ç‰ˆæœ¬å·
      id: get_version
      run: echo "VERSION=$(echo ${{ github.ref_name }} | sed 's/v//g')" >> $GITHUB_OUTPUT
      
    - name: æ›´æ–° version.js æ–‡ä»¶
      run: |
        VERSION_TAG="${{ github.ref_name }}"
        sed -i "s/const VERSIONS = '.*'/const VERSIONS = '${VERSION_TAG}'/" version.js
        
    - name: æäº¤æ›´æ–°åçš„æ–‡ä»¶
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ¤– è‡ªåŠ¨æ›´æ–° version.js ç‰ˆæœ¬å·åˆ° ${{ github.ref_name }}"
        file_pattern: version.js
