name: Auto Update Version

on:
  push:
    tags:
      - 'v*.*.*' # åŒ¹é…æ‰€æœ‰ vX.Y.Z æ ¼å¼çš„ Git Tag

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        # è·å–å®Œæ•´çš„å†å²è®°å½•ï¼Œä»¥ä¾¿èƒ½æäº¤
        fetch-depth: 0 
        
    - name: æå–æ–°ç‰ˆæœ¬å·
      id: get_version
      run: echo "VERSION=$(echo ${{ github.ref_name }} | sed 's/v//g')" >> $GITHUB_OUTPUT
      # æ³¨ï¼šgithub.ref_name å°±æ˜¯æ–°çš„ Tag åç§°ï¼Œä¾‹å¦‚ v1.0.2
      
    - name: æ›´æ–° js/version.js æ–‡ä»¶
      run: |
        VERSION_TAG="${{ github.ref_name }}"
        # ä½¿ç”¨ sed å‘½ä»¤æ›¿æ¢æ–‡ä»¶å†…å®¹
        sed -i "s/const VERSIONS = '.*'/const VERSIONS = '${VERSION_TAG}'/" js/version.js
        
    - name: æäº¤æ›´æ–°åçš„æ–‡ä»¶
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ¤– è‡ªåŠ¨æ›´æ–° js/version.js ç‰ˆæœ¬å·åˆ° ${{ github.ref_name }}"
        files: js/version.js
        # ä½¿ç”¨ GitHub Token è¿›è¡Œæäº¤ï¼Œç¡®ä¿æäº¤æ˜¯ç”± Action å‘èµ·çš„
        token: ${{ secrets.GITHUB_TOKEN }}
